<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Unity WebGL Player | arm_sim</title>
        <style>
            body,
            html {
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #unity-canvas {
                width: 100%;
                height: 100%;
                background: red;
            }
        </style>
    </head>
    <body>
        <canvas
            id="unity-canvas"
            width="100%"
            height="100%"
            tabindex="-1"
        ></canvas>
        <script src="Build/test.loader.js"></script>
        <script>
            var gameInstance = null; // Declare gameInstance at the top of your script block
            function getQueryParams() {
                var queryParams = {};
                location.search.replace(
                    /[?&]+([^=&]+)=([^&]*)/gi,
                    function (str, key, value) {
                        queryParams[key] = value;
                    }
                );
                return queryParams;
            }
            function GetWebSocketInfo() {
                var params = getQueryParams();
                var ip = params.ip;
                var port = params.port;
                if (ip && port && gameInstance) {
                    gameInstance.SendMessage(
                        "controller",
                        "SetWebSocketInfo",
                        ip + ":" + port
                    );
                    console.log("SetWebSocketInfo: " + ip + ":" + port
                    );
                }
            }

            window.addEventListener("resize", function () {
                var canvas = document.getElementById("unity-canvas");
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });

            gameInstance = createUnityInstance(
                document.querySelector("#unity-canvas"),
                {
                    // Assign to gameInstance
                    dataUrl: "Build/test.data.gz",
                    frameworkUrl: "Build/test.framework.js.gz",
                    codeUrl: "Build/test.wasm.gz",
                    streamingAssetsUrl: "StreamingAssets",
                    companyName: "DefaultCompany",
                    productName: "arm_sim",
                    productVersion: "0.1",
                    matchWebGLToCanvasSize: false,
                }
            );

            // Call GetWebSocketInfo when Unity is fully loaded, assuming Unity's default loading method
            gameInstance.then(() => {
                GetWebSocketInfo();
            });
        </script>
    </body>
</html>
